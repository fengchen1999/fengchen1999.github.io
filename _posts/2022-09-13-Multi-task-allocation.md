---
layout: post
title: "无人机多任务分配与路径规划"
categories: tech
tags: [UAV]
---



本文总结自Arthur Richards 的《MULTI-TASK ALLOCATION AND PATH PLANNING FOR COOPERATING UAVS》。

## 问题的三个决策层面

1. 目标分配：建立团队并将任务目标分配给各个团队
2. 任务分配：将任务分配给各个团队成员
3. 轨迹规划：为各个团队成员设计路径完成任务（注：一般来说运动规划（motion）包括路径规划（path）和轨迹规划（trajectory），路径没有速度和加速度信息，而轨迹有。）

![image.png](https://s2.loli.net/2022/09/13/FeBZRdupvioEXYM.png)

​	本文假设目标分配已经完成，即各个航点（即无人机需要访问的任务点）的位置，访问时间和访问次数已知。如果我们对任务分配和轨迹规划同时进行规划，计算难度过大。本文采取分层优化的思路：1）预估各个排列（即一组航点的访问序列）所需的时间（图2.4.）；2）基于估计的时间进行任务规划，将排列分配给无人机（图2.6.）；3）设计每台无人机的排列进行最优轨迹；4）检查无人机的轨迹是否冲突，若冲突，返回3），若仍然冲突，返回2）。

## 可行排列与其估计成本

​	怎么找出排列呢？首先建立一个集合，包括各个无序航点组合 $T_i$ 。基于最优路径经过障碍物多项式凸包顶点的假设，利用最短路径规划算法（例如A*算法）找出排列 $S_i$ ，修剪掉成本明显过高的排列，得到可行排列 $\{1, \cdots, N_M\}$ ，其最短路径时间即为其估计成本 $c_j, ~~ j \in \{1, \cdots, N_M\}$ 。



## 任务分配

基础的任务分配问题可以建模成一个多维多选择的背包问题（Multi-dimensional Multiple-Choice Knapsack Problem, MMKP）。
$$
\begin{align}
&\min ~~ J=\sum_{j=1}^{N_M} c_jx_j \\
\mathrm{subject ~~ to: ~~ } & \sum_{j=1}^{N_M} V_{ij}x_j \geq w_i, ~~ \forall i \in \{1, \cdots, N_W\}, \\
& \sum_{j=N_p}^{N_{p+1}-1} x_j = 1, ~~ \forall p \in \{1, \cdots, N_V\},
\end{align}
$$
其中无人机 $p$ 的排列被标号为 $N_p$ 到 $N_{p+1}-1$，同时 $N_1 = 1$，$N_{N_{V}+1} = N_{M}+1$。$c_j$ 表示每个排列的成本（一般为任务时间），$x_j$ 是一个布尔决策变量，$x_j=1$ 表示排列 $j$ 被选择，否则为0。$V_{ij}=1$ 表示航点 $i$ 被排列 $j$ 访问。$w_i$ 是航点 $i$ 需要被访问的次数。 目标（1）最小化总任务时间。约束（2）保证每个航点的访问次数被满足。约束（3）保证每架无人机只选择一个排列。多维体现在约束（3），多选择体现在约束（2），每个排列上的航点可以选择被装进任意一个背包，不是很确定否可以这样理解。

对于以上基本模型，可以进行一些修改。

**修改目标函数**
$$
\min ~~ J = \overline{t} + \frac{\alpha}{N_V}\sum_{j=1}^{N_M} c_jx_j
$$
其中，$\overline{t}$ 表示最大任务时间。最小化 $\overline{t}$ 即可保证完成总体任务的时间最小。最小化平均时间是防止将带有不必要航点的排列分配给非最大任务时间的无人机，造成资源的浪费。$\alpha$ 是权重系数。

**时间约束**
$$
\begin{align}
\sum_{j=1}^{N_M} (T_{Bj}x_j - T_{Aj}x_j) + WT_B - WT_A \geq t_D, \\
WT_A \leq VT_p + R(1 - \sum_{j=N_p}^{N_{p+1}-1} V_{Aj}x_j), ~~ \forall p \in \{1, \cdots, N_V\}, \\
WT_A \geq VT_p + R(1 - \sum_{j=N_p}^{N_{p+1}-1} V_{Aj}x_j), ~~ \forall p \in \{1, \cdots, N_V\}, \\
WT_B \leq VT_p + R(1 - \sum_{j=N_p}^{N_{p+1}-1} V_{Bj}x_j), ~~ \forall p \in \{1, \cdots, N_V\}, \\
WT_B \geq VT_p + R(1 - \sum_{j=N_p}^{N_{p+1}-1} V_{Bj}x_j), ~~ \forall p \in \{1, \cdots, N_V\}, \\
\end{align}
$$
其中， $T_{Aj}$ 表示序列 $j$ 到达航点A的时间，$WT_A$ 是辅助变量，决定了离开航点A的时间；$VT_p$ 表示无人机 $p$ 没有延迟的开始执行任务的间，$R$ 表示很大的数字。当 $(1 - \sum_{j=N_p}^{N_{p+1}-1} V_{Aj}x_j) = 0$ 或 $(1 - \sum_{j=N_p}^{N_{p+1}-1} V_{Aj}x_j) = 0$ 时，无人机 $p$ 没有经过航点A或B，约束（5-9）被松弛。反之，无人机 $p$ 经过航点A和B，约束（5）退化为 $\sum_{j=1}^{N_M} (T_{Bj}x_j - T_{Aj}x_j) \geq t_D$ 。约束（5）表示航点A先于航点B至少 $t_D$ 时间被访问。此时，目标函数可以进一步修改为公式（10）。
$$
\min ~~ J = \overline{t} + \frac{\alpha}{N_V}\sum_{j=1}^{N_M} c_jx_j + \frac{\alpha}{N_V}\sum_{j=1}^{N_V} VT_p
$$
表示延迟无人机开始时间可以转化为其他时间约束，例如运行无人机在前往下一个领航点前停留一段时间。（不是很懂）

## 动态环境

在执行任务的过程中可能会遇到各种环境变化，如果问题规模比较小，可以直接进行一次规划。如果问题规模比较大，那么直接重新规划不能满足实时性要求，有两种策略应对动态环境：局部修复和子团队分配问题。

**局部修复：**只重新规划一架无人机。保持已经过的航点排列不变，对新加进来的航点和未经过的航点进行重新规划。这是一种时间断面，探测到新环境前的排列不变，只改变之后的排列，使得问题规模变小。

**子团队分配问题：**制定一个有能力访问新航点的无人机子团队规划问题。只是一种能力断面。针对没有剩余能力或不受影响的无人机的规划不变，只改变有剩余能力和受到环境影响的无人机的规划，使得问题规模变小。

























